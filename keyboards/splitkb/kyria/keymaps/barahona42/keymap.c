#include QMK_KEYBOARD_H
#include <stdio.h>
char wpm_str[10];

// clang-format off
// GUI
#define LGUI_F      MT(MOD_LGUI, KC_F)      // hold: left gui       tap: f
#define RGUI_J      MT(MOD_RGUI, KC_J)      // hold: right gui      tap: j
// ALT
#define LALT_D      MT(MOD_LALT, KC_D)      // hold: left alt       tap: d
#define RALT_K      MT(MOD_RALT, KC_K)      // hold: right alt      tap: k
// CTL
#define LCTL_S      MT(MOD_LCTL, KC_S)      // hold: left ctl       tap: s
#define RCTL_L      MT(MOD_RCTL, KC_L)      // hold: right ctl      tap: l
// etc
#define RSTF_ENT    MT(MOD_RSFT, KC_ENT)    // hold: right shift    tap: enter
#define SYMS_SPC    LT(SYMS, KC_SPC)        // hold: symbols layer  tap: space
#define LAY1_SPC    LT(LAY1, KC_SPC)
#define LAY2_SPC    LT(LAY2, KC_SPC)
#define LGUI_SPC    MT(MOD_LGUI, KC_SPC)
#define RGUI_SPC    MT(MOD_RGUI, KC_SPC)
#define RALT_NAVS   LT(NAVS, KC_RALT)
// #define SPC_RAIS    MT()
// clang-format on
void master_oled_display(void);
void secondary_oled_display(void);

enum custom_layers {
    BASE = 0,
    LAY1,
    LAY2,
    SYMS,
    NUMS,
    NAVS,
    CONF
};

enum custom_tapdances {
    TD_MEDIA = 0
};

tap_dance_action_t tap_dance_actions[] = {};
combo_t key_combos[] = {};
// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [BASE] = LAYOUT(
        KC_TAB,     KC_Q,       KC_W,       KC_E,       KC_R,       KC_T,                                                                   KC_Y,      KC_U,       KC_I,       KC_O,       KC_P,       KC_BSPC,
        KC_ESC,     KC_A,       LCTL_S,     LALT_D,     LGUI_F,     KC_G,                                                                   KC_H,      RGUI_J,     RALT_K,     RCTL_L,     KC_SCLN,    KC_QUOT,
        KC_LSFT,    KC_Z,       KC_X,       KC_C,       KC_V,       KC_B,       _______,    MO(CONF),                MO(CONF),    MO(NAVS), KC_N,      KC_M,       KC_COMM,    KC_DOT,     KC_SLSH,    RSTF_ENT,
                                            KC_LCTL,    KC_LALT,    KC_LGUI,    LAY2_SPC,   MO(NUMS),                MO(NUMS),    LAY1_SPC, KC_RGUI,  KC_RALT,  KC_RCTL
    ),

    [LAY1] = LAYOUT(
        KC_GRV,     _______,    KC_UP,      _______,    _______,    _______,                                                                _______,    _______,    KC_LPRN,    KC_RPRN,    KC_EQL,     KC_DEL,
        _______,    KC_LEFT,    KC_DOWN,    KC_RIGHT,   _______,    _______,                                                                _______,    KC_UNDS,    KC_LBRC,    KC_RBRC,    _______,    KC_BSLS,
        _______,    _______,    _______,    _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    KC_MINS,    KC_LCBR,    KC_RCBR,    _______,    _______,
                                            _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______
    ),
    [LAY2] = LAYOUT(
        _______,    _______,    _______,    _______,    _______,    _______,                                                                _______,    _______,    _______,    _______,    _______,    _______,
        _______,    KC_EXLM,    KC_AT,      KC_HASH,    KC_DLR,     _______,                                                                _______,    _______,    _______,    _______,    _______,    _______,
        _______,    KC_PERC,    KC_CIRC,    KC_AMPR,    KC_ASTR,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______,    _______,    _______,    _______,
                                            _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______
    ),
    [SYMS] = LAYOUT(
        KC_GRV,     _______,    _______,    _______,    _______,    _______,                                                                _______,    _______,    KC_LPRN,    KC_RPRN,    KC_EQL,     KC_DEL,
        _______,    KC_EXLM,    KC_AT,      KC_HASH,    KC_DLR,     _______,                                                                _______,    KC_UNDS,    KC_LBRC,    KC_RBRC,    _______,    KC_BSLS,
        _______,    KC_PERC,    KC_CIRC,    KC_AMPR,    KC_ASTR,    _______,    _______,    _______,                _______,    _______,    _______,    KC_MINS,    KC_LCBR,    KC_RCBR,    _______,    _______,
                                            _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______
    ),
    [NUMS]= LAYOUT(
        _______,    KC_1,       KC_2,       KC_3,       KC_4,       KC_5,                                                                   KC_6,       KC_7,       KC_8,       KC_9,       KC_0,       KC_DEL,
        _______,    _______,    _______,    _______,    _______,    _______,                                                                _______,    KC_4,       KC_5,       KC_6,       _______,    _______,
        _______,    _______,    _______,    _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    KC_1,       KC_2,       KC_3,       _______,    _______,
                                            _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    KC_0,       _______
    ),
    [NAVS]= LAYOUT(
        KC_HOME,    _______,    KC_UP,      _______,    KC_PGUP,    _______,                                                                _______,    _______,    _______,    _______,    _______,    KC_DEL,
        KC_DOWN,    KC_LEFT,    KC_DOWN,    KC_RIGHT,   KC_PGDN,    _______,                                                                _______,    KC_RGUI,    KC_RALT,    KC_RCTL,    _______,    _______,
        KC_LSFT,    _______,    _______,    _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______,    _______,    _______,    _______,
                                            _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______
    ),
    [CONF]= LAYOUT(
        BL_TOGG,    _______,    _______,    _______,    _______,    _______,                                                                _______,    _______,    _______,    _______,    QK_MAKE,    QK_BOOT,
        RGB_TOG,    RGB_MOD,    _______,    _______,    _______,    _______,                                                                _______,    _______,    _______,    _______,    _______,    _______,
        UG_TOGG,    UG_SPDU,    UG_SPDD,    UG_NEXT,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______,    _______,    _______,    _______,
                                            _______,    _______,    _______,    _______,    _______,                _______,    _______,    _______,    _______,    _______
    )
};
void master_oled_display(void){
        // QMK Logo and version information
        // clang-format off
        static const char PROGMEM qmk_logo[] = {
            0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
            0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
            0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0
        };
        // clang-format on

        oled_write_P(qmk_logo, false);
        oled_write_P(PSTR("Layer:"), false);

        // Host Keyboard Layer Status
        switch (get_highest_layer(layer_state|default_layer_state)) {
            case BASE:
                oled_write_P(PSTR("BASE\n"), false);
                break;
            case SYMS:
                oled_write_P(PSTR("SYMS\n"), false);
                break;
            case NUMS:
                oled_write_P(PSTR("NUMS\n"), false);
                break;
            case NAVS:
                oled_write_P(PSTR("NAVS\n"), false);
                break;
            case CONF:
                oled_write_P(PSTR("CONF\n"), false);
                break;
            default:
                oled_write_P(PSTR("idk\n"), false);
        }

        // Write host Keyboard LED Status to OLEDs
        led_t led_usb_state = host_keyboard_led_state();
        oled_write_P(led_usb_state.num_lock    ? PSTR("NUMLCK ") : PSTR("       "), false);
        oled_write_P(led_usb_state.caps_lock   ? PSTR("CAPLCK ") : PSTR("       "), false);
        oled_write_P(led_usb_state.scroll_lock ? PSTR("SCRLCK ") : PSTR("       "), false);

        oled_write_P(PSTR("\n\nkyria rev3"), false);
}

void secondary_oled_display() {
    static const char PROGMEM kyria_logo[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0xc0, 0x30, 0x08, 0x08, 0x04, 0x84, 0x62, 0x12, 0x0a, 0x0a, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0x40, 0x60, 0x20, 0x30, 0x30, 0x30, 0x20, 0xc0,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x0c, 0x03,
        0x00, 0x00, 0x00, 0xc0, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20,
        0xf0, 0xf0, 0x38, 0x0c, 0x02, 0x01, 0x00, 0x80, 0xf0, 0xfc, 0xfe, 0xff, 0xff, 0xff, 0xfc, 0x30,
        0x0f, 0x02, 0x02, 0x02, 0x02, 0x02, 0x04, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0x0c, 0xf0,
        0x00, 0x00, 0x00, 0x00, 0x03, 0x02, 0x02, 0x02, 0x02, 0x06, 0x02, 0x02, 0x01, 0x00, 0x00, 0x1e,
        0xff, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x1f, 0x7f, 0x7f, 0x7f, 0x0f, 0x03, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03,
        0x03, 0x02, 0x04, 0x04, 0x08, 0x08, 0x00, 0x10, 0x00, 0x20, 0x40, 0xc0, 0x80, 0x00, 0x00, 0x00,
        0x7f, 0x00, 0x00, 0x00, 0x00, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x0c, 0x08,
        0x10, 0x3f, 0x70, 0x80, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0e, 0x1c, 0x20, 0x42, 0x42, 0x42, 0x82, 0xa0,
        0x20, 0x10, 0x12, 0x12, 0x0a, 0x0c, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x10, 0x10, 0x08, 0x08,
        0x04, 0x84, 0x02, 0x02, 0x43, 0x40, 0x40, 0x20, 0x60, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01, 0x01, 0x02, 0x02, 0x04, 0x04, 0x04, 0x08, 0x08, 0x10, 0x10, 0x10, 0x20, 0x20, 0x40, 0x40,
        0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x00, 0x01, 0x01,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x07, 0x06, 0x06, 0x04, 0x04,
        0x08, 0x08, 0x10, 0x10, 0x20, 0x00, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x1c, 0x24, 0xc4, 0x84, 0x04, 0x04, 0x00, 0x08, 0x08, 0x08, 0x00, 0x10, 0x10, 0x30, 0x00, 0x10,
        0x11, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x08, 0x18, 0x30, 0x60,
        0x20, 0x40, 0x40, 0xc1, 0xc3, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    oled_write_raw_P(kyria_logo, sizeof(kyria_logo));
}

bool oled_task_user(void) {
    if (is_keyboard_master()) {
        master_oled_display();
    } else {
        secondary_oled_display();
    }
    return false;
}


// #ifdef ENCODER_ENABLE
// bool encoder_update_user(uint8_t index, bool clockwise) {

//     if (index == 0) {
//         // Volume control
//         if (clockwise) {
//             tap_code(KC_VOLU);
//         } else {
//             tap_code(KC_VOLD);
//         }
//     } else if (index == 1) {
//         // Page up/Page down
//         if (clockwise) {
//             tap_code(KC_PGDN);
//         } else {
//             tap_code(KC_PGUP);
//         }
//     }
//     return false;
// }
// #endif
